[supervisord]
nodaemon=true
user=app
logfile=/tmp/supervisord.log
pidfile=/tmp/supervisord.pid

[unix_http_server]
file=/tmp/supervisor.sock
chmod=0700

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

# ---------------------------------------------------------
# ComfyUI (Port 8188)
# ---------------------------------------------------------
[program:comfyui]
command=/bin/bash -c "source /opt/venv/bin/activate && cd /opt/comfyui && python main.py --listen 0.0.0.0 --port ${PORT:-8188}"
directory=/opt/comfyui
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=10

# ---------------------------------------------------------
# File Browser (Port 8080)
# ---------------------------------------------------------
[program:filebrowser]
command=/bin/bash -c "source /opt/venv/bin/activate && export FILE_BROWSER_PORT=8080 && export WORKSPACE=/workspace && python /usr/local/bin/file_browser.py"
directory=/workspace
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=20

# ---------------------------------------------------------
# SpriteForge GUI Backend (Port 5000)
# ---------------------------------------------------------
[program:spriteforge-gui]
command=/bin/bash -c "source /opt/venv/bin/activate && python app.py"
directory=/workspace/pipeline/gui
autostart=true
autorestart=true
stdout_logfile=/workspace/pipeline/logs/gui.log
stderr_logfile=/workspace/pipeline/logs/gui.err
stdout_logfile_maxbytes=0
stderr_logfile_maxbytes=0
priority=30
