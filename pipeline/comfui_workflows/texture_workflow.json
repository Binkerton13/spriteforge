{
  "last_node_id": 17,
  "last_link_id": 18,
  "nodes": [
    {
      "id": 1,
      "type": "LoadImage",
      "pos": [50, 50],
      "inputs": {
        "image": "uv"
      }
    },
    {
      "id": 2,
      "type": "CheckpointLoaderSimple",
      "pos": [50, 250],
      "inputs": {
        "ckpt_name": "sdxl_base_1.0.safetensors"
      }
    },
    {
      "id": 3,
      "type": "CLIPTextEncode",
      "pos": [350, 50],
      "inputs": {
        "text": "prompt"
      }
    },
    {
      "id": 4,
      "type": "CLIPTextEncode",
      "pos": [350, 200],
      "inputs": {
        "text": "negative"
      }
    },
    {
      "id": 15,
      "type": "LoadImage",
      "pos": [50, 450],
      "inputs": {
        "image": "style_reference",
        "optional": true
      },
      "comment": "Optional style reference image"
    },
    {
      "id": 16,
      "type": "IPAdapterModelLoader",
      "pos": [350, 450],
      "inputs": {
        "ipadapter_file": "ip-adapter_sdxl.safetensors"
      },
      "comment": "IP-Adapter for style transfer"
    },
    {
      "id": 17,
      "type": "IPAdapter",
      "pos": [650, 450],
      "inputs": {
        "model": ["2", 0],
        "ipadapter": ["16", 0],
        "image": ["15", 0],
        "weight": 0.5,
        "weight_type": "linear",
        "start_at": 0.0,
        "end_at": 1.0,
        "unfold_batch": false
      },
      "comment": "Apply style reference if provided"
    },
    {
      "id": 9,
      "type": "ControlNetLoader",
      "pos": [350, 350],
      "inputs": {
        "control_net_name": "controlnet_canny.safetensors"
      }
    },
    {
      "id": 8,
      "type": "ControlNetApply",
      "pos": [650, 350],
      "inputs": {
        "control_net": ["9", 0],
        "conditioning": ["3", 0]
      }
    },
    {
      "id": 5,
      "type": "KSampler",
      "pos": [900, 100],
      "inputs": {
        "model": ["17", 0],
        "positive": ["8", 0],
        "negative": ["4", 0],
        "latent_image": ["1", 0],
        "seed": "seed",
        "steps": 25,
        "cfg": 7.0,
        "sampler_name": "euler",
        "scheduler": "normal"
      },
      "comment": "Now uses model with IP-Adapter applied"
    },
    {
      "id": 10,
      "type": "CheckpointLoaderSimple",
      "pos": [650, 500],
      "inputs": {
        "ckpt_name": "sdxl_refiner_1.0.safetensors"
      }
    },
    {
      "id": 11,
      "type": "KSampler",
      "pos": [900, 500],
      "inputs": {
        "model": ["10", 0],
        "positive": ["3", 0],
        "negative": ["4", 0],
        "latent_image": ["5", 0],
        "seed": "seed",
        "steps": 15,
        "cfg": 5.0,
        "sampler_name": "euler",
        "scheduler": "normal"
      }
    },
    {
      "id": 12,
      "type": "VAEDecode",
      "pos": [1150, 500],
      "inputs": {
        "samples": ["11", 0],
        "vae": ["10", 1]
      }
    },
    {
      "id": 13,
      "type": "ImageSharpen",
      "pos": [1400, 500],
      "inputs": {
        "image": ["12", 0],
        "amount": 0.15
      }
    },
    {
      "id": 14,
      "type": "ColorCorrect",
      "pos": [1650, 500],
      "inputs": {
        "image": ["13", 0],
        "brightness": 0.0,
        "contrast": 0.0,
        "saturation": 0.0,
        "gamma": 1.0
      }
    },
    {
      "id": 7,
      "type": "SaveImage",
      "pos": [1900, 500],
      "inputs": {
        "filename_prefix": "output",
        "image": ["14", 0]
      }
    }
  ],
  "links": [
    [1, 0, 5, 3],
    [2, 0, 5, 0],
    [3, 0, 8, 1],
    [4, 0, 5, 2],
    [9, 0, 8, 0],
    [8, 0, 5, 1],
    [5, 0, 11, 3],
    [10, 0, 11, 0],
    [10, 1, 12, 1],
    [11, 0, 12, 0],
    [12, 0, 13, 0],
    [13, 0, 14, 0],
    [14, 0, 7, 0]
  ]
}
